<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Tempero & Sabor</title>
    <link rel="stylesheet" href="admin.css">
</head>
<body>
    <div class="admin-container">
        <header class="admin-header">
            <div class="header-content">
                <h1>üçî Gerenciamento - Tempero & Sabor</h1>
                <div class="header-actions">
                    <a href="../index.html" class="btn-view-site" target="_blank">Ver Site</a>
                    <button id="logout-btn" class="btn-logout">Sair</button>
                </div>
            </div>
        </header>

        <nav class="admin-nav">
            <button class="nav-btn active" data-section="products">
                <span>üì¶</span> Produtos
            </button>
            <button class="nav-btn" data-section="ingredients">
                <span>ü•¨</span> Ingredientes
            </button>
            <button class="nav-btn" data-section="config">
                <span>‚öôÔ∏è</span> Configura√ß√µes
            </button>
        </nav>

        <!-- Se√ß√£o de Produtos -->
        <section id="products-section" class="admin-section active">
            <div class="section-header">
                <h2>Gerenciar Produtos</h2>
                <button id="add-product-btn" class="btn-primary">
                    <span>+</span> Adicionar Produto
                </button>
            </div>

            <div class="loading" id="products-loading" style="display: none;">
                Carregando produtos...
            </div>

            <!-- Controles de Sele√ß√£o em Massa e Filtros -->
            <div class="products-controls">
                <div class="bulk-actions">
                    <label class="select-all-label">
                        <input type="checkbox" id="select-all-checkbox">
                        <span>Selecionar Todos</span>
                        <span class="selection-count" id="selection-count"></span>
                    </label>
                    <div class="bulk-action-buttons">
                        <button id="activate-selected-btn" class="btn-bulk-action" disabled>
                            Ativar Selecionados
                        </button>
                        <button id="deactivate-selected-btn" class="btn-bulk-action" disabled>
                            Desativar Selecionados
                        </button>
                        <button id="delete-selected-btn" class="btn-bulk-action btn-danger" disabled>
                            Excluir Selecionados
                        </button>
                    </div>
                </div>
                <div class="products-filters">
                    <select id="category-filter" class="category-select">
                        <option value="all">Todas as Categorias</option>
                    </select>
                    <div class="search-container">
                        <input type="text" id="product-search-input" class="search-input" placeholder="Buscar produto...">
                        <button id="clear-search-btn" class="clear-search-btn" style="display: none;">&times;</button>
                    </div>
                </div>
            </div>

            <div class="products-grid" id="products-grid">
                <!-- Produtos ser√£o carregados aqui -->
            </div>
        </section>

        <!-- Se√ß√£o de Ingredientes -->
        <section id="ingredients-section" class="admin-section">
            <div class="section-header">
                <h2>Gerenciar Ingredientes</h2>
            </div>

            <div class="loading" id="ingredients-loading" style="display: none;">
                Carregando ingredientes...
            </div>

            <!-- Barra de Filtros com √çcones -->
            <div class="filters-toolbar">
                <div class="filter-icon-btn" data-filter="search" title="Buscar">
                    <span class="filter-icon">üîç</span>
                    <span class="filter-label">Buscar</span>
                </div>
                <div class="filter-icon-btn" data-filter="select" title="Selecionar">
                    <span class="filter-icon">‚òëÔ∏è</span>
                    <span class="filter-label">Selecionar</span>
                </div>
                <div class="filter-icon-btn" data-filter="status" title="Status">
                    <span class="filter-icon">üìä</span>
                    <span class="filter-label">Status</span>
                </div>
                <div id="add-ingredient-btn" class="filter-icon-btn" title="Adicionar Ingrediente">
                    <span class="filter-icon">+</span>
                    <span class="filter-label">Ingrediente</span>
                </div>
                <div id="manage-categories-btn" class="filter-icon-btn" title="Categorias">
                    <span class="filter-icon">üìÅ</span>
                    <span class="filter-label">Categorias</span>
                </div>
            </div>

            <!-- Painel de Busca -->
            <div class="filter-panel" id="ingredient-search-panel" style="display: none;">
                <div class="search-container">
                    <input type="text" id="ingredient-search-input" class="search-input" placeholder="Buscar ingrediente...">
                    <button id="clear-ingredient-search-btn" class="clear-search-btn" style="display: none;">&times;</button>
                </div>
            </div>

            <!-- Painel de Sele√ß√£o -->
            <div class="filter-panel" id="ingredient-select-panel" style="display: none;">
                <div class="bulk-actions">
                    <label class="select-all-label">
                        <input type="checkbox" id="select-all-ingredients-checkbox">
                        <span>Selecionar Todos</span>
                        <span class="selection-count" id="ingredients-selection-count"></span>
                    </label>
                    <div class="bulk-action-buttons">
                        <button id="activate-selected-ingredients-btn" class="btn-bulk-action" disabled>
                            Ativar Selecionados
                        </button>
                        <button id="deactivate-selected-ingredients-btn" class="btn-bulk-action" disabled>
                            Desativar Selecionados
                        </button>
                        <button id="delete-selected-ingredients-btn" class="btn-bulk-action btn-danger" disabled>
                            Excluir Selecionados
                        </button>
                    </div>
                </div>
            </div>

            <!-- Painel de Status -->
            <div class="filter-panel" id="ingredient-status-panel" style="display: none;">
                <div class="status-filters">
                    <button class="status-filter-btn active" data-status="all">Todos</button>
                    <button class="status-filter-btn" data-status="active">Ativos</button>
                    <button class="status-filter-btn" data-status="inactive">Inativos</button>
                </div>
            </div>

            <!-- Seletor de Categorias -->
            <div class="category-filter-bar">
                <label class="category-filter-label">Categoria:</label>
                <select id="ingredient-category-filter" class="category-filter-select">
                    <option value="all">Todas as Categorias</option>
                </select>
            </div>

            <div class="products-grid" id="ingredients-grid">
                <!-- Ingredientes ser√£o carregados aqui -->
            </div>
        </section>

        <!-- Se√ß√£o de Configura√ß√µes -->
        <section id="config-section" class="admin-section">
            <div class="section-header">
                <h2>Configura√ß√µes do Restaurante</h2>
            </div>
            <div class="config-form-container">
                <form id="config-form">
                    <div class="form-group">
                        <label for="config-name">Nome do Restaurante *</label>
                        <input type="text" id="config-name" required>
                    </div>

                    <div class="form-group">
                        <label for="config-whatsapp">N√∫mero WhatsApp *</label>
                        <input type="text" id="config-whatsapp" placeholder="67982077085" required>
                    </div>

                    <div class="form-group">
                        <label for="config-latitude">Latitude</label>
                        <input type="number" id="config-latitude" step="any">
                    </div>

                    <div class="form-group">
                        <label for="config-longitude">Longitude</label>
                        <input type="number" id="config-longitude" step="any">
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn-save">Salvar Configura√ß√µes</button>
                    </div>
                </form>
            </div>
        </section>
    </div>

    <!-- Modal de Ingrediente -->
    <div id="ingredient-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="ingredient-modal-title">Adicionar Ingrediente</h3>
                <button class="modal-close" id="ingredient-modal-close">&times;</button>
            </div>
            
            <!-- Abas -->
            <div class="modal-tabs">
                <button class="modal-tab active" data-tab="single">Adicionar</button>
                <button class="modal-tab" data-tab="batch">+ Lista de ingredientes</button>
            </div>
            
            <div class="modal-body">
                <!-- Aba: Adicionar √∫nico -->
                <div id="ingredient-tab-single" class="modal-tab-content active">
                    <form id="ingredient-form">
                        <input type="hidden" id="ingredient-id">
                        
                        <!-- √Årea de mensagem de erro -->
                        <div id="ingredient-form-error" class="form-error-message" style="display: none;"></div>
                        
                    <div class="form-group">
                        <label for="ingredient-name">Nome do Ingrediente *</label>
                        <input type="text" id="ingredient-name" required>
                    </div>

                    <div class="form-group">
                        <label for="ingredient-category">Categoria *</label>
                        <select id="ingredient-category" required>
                            <option value="">Carregando categorias...</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="ingredient-price">Pre√ßo (R$) *</label>
                        <input type="number" id="ingredient-price" step="0.01" min="0" required>
                    </div>

                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="ingredient-active" checked>
                                <span>Ingrediente ativo</span>
                            </label>
                        </div>
                    </form>
                </div>
                
                <!-- Aba: Lista de ingredientes -->
                <div id="ingredient-tab-batch" class="modal-tab-content">
                    <form id="ingredient-batch-form">
                        <div class="form-group">
                            <label>Op√ß√£o de Pre√ßo *</label>
                            <div class="radio-group">
                                <label class="radio-label">
                                    <input type="radio" name="price-mode" value="none" checked>
                                    <span>Sem pre√ßo (R$ 0,00)</span>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="price-mode" value="individual">
                                    <span>Pre√ßo individual</span>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="price-mode" value="unique">
                                    <span>Pre√ßo √∫nico para todos</span>
                                </label>
                            </div>
                        </div>

                        <div class="form-group" id="price-unique-group" style="display: none;">
                            <label for="price-unique">Pre√ßo √önico (R$) *</label>
                            <input type="number" id="price-unique" step="0.01" min="0" placeholder="0.00">
                            <small>Este pre√ßo ser√° aplicado a todos os ingredientes da lista.</small>
                        </div>

                        <div class="form-group">
                            <label for="ingredient-list">Lista de Ingredientes *</label>
                            <textarea 
                                id="ingredient-list" 
                                rows="6" 
                                placeholder="Digite os ingredientes separados por v√≠rgula&#10;Exemplo: P√£o, Molho Mima, Alface, Tomate, Cebola"
                                required></textarea>
                            <small id="ingredient-list-hint">Separe os ingredientes por v√≠rgula. Todos ser√£o criados com pre√ßo R$ 0,00 e como ativos.</small>
                        </div>
                    </form>
                </div>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn-cancel" id="cancel-ingredient-btn">Cancelar</button>
                <button type="submit" form="ingredient-form" class="btn-save" id="ingredient-save-btn" style="display: none;">Salvar</button>
                <button type="submit" form="ingredient-batch-form" class="btn-save" id="ingredient-batch-save-btn" style="display: none;">Criar Ingredientes</button>
            </div>
        </div>
    </div>

    <!-- Modal de Editar Ingrediente -->
    <div id="ingredient-edit-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="ingredient-edit-modal-title">Editar Ingrediente</h3>
                <button class="modal-close" id="ingredient-edit-modal-close">&times;</button>
            </div>
            
            <div class="modal-body">
                <form id="ingredient-edit-form">
                    <input type="hidden" id="ingredient-edit-id">
                    
                    <div class="form-group">
                        <label for="ingredient-edit-name">Nome do Ingrediente *</label>
                        <input type="text" id="ingredient-edit-name" required>
                    </div>

                    <div class="form-group">
                        <label for="ingredient-edit-category">Categoria *</label>
                        <select id="ingredient-edit-category" required>
                            <option value="">Carregando categorias...</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="ingredient-edit-price">Pre√ßo (R$) *</label>
                        <input type="number" id="ingredient-edit-price" step="0.01" min="0" required>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="ingredient-edit-active" checked>
                            <span>Ingrediente ativo</span>
                        </label>
                    </div>
                </form>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn-cancel" id="cancel-ingredient-edit-btn">Cancelar</button>
                <button type="submit" form="ingredient-edit-form" class="btn-save" id="ingredient-edit-save-btn">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Produto -->
    <div id="product-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Adicionar Produto</h3>
                <button class="modal-close" id="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="product-form">
                    <input type="hidden" id="product-id">
                    
                    <!-- Seletor de Imagem -->
                <div class="form-group">
                    <label for="product-image-input">Imagem do Produto *</label>
                    <div class="image-upload-container">
                        <input type="file" id="product-image-input" accept="image/*" style="display: none;">
                        <div class="image-upload-area" id="image-upload-area">
                            <div class="image-upload-placeholder" id="image-upload-placeholder">
                                <span class="upload-icon">üì∑</span>
                                <p>Clique para selecionar uma imagem</p>
                                <small>ou arraste e solte aqui</small>
                            </div>
                            <div class="image-preview-container" id="image-preview-container" style="display: none;">
                                <div class="image-preview-wrapper">
                                    <div class="preview-item">
                                        <div class="image-preview" id="image-preview-original">
                                            <img id="preview-original-img" alt="Preview da imagem">
                                        </div>
                                    </div>
                                </div>
                                <div class="image-upload-controls">
                                    <button type="button" class="btn-remove-image" id="remove-image-btn">Remover Imagem</button>
                                </div>
                                <div class="image-upload-loading" id="image-upload-loading" style="display: none;">
                                    <div class="spinner"></div>
                                    <p>Fazendo upload da imagem...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <input type="hidden" id="product-image-url">
                </div>
                
                <div class="form-group">
                    <label for="product-name">Nome do Produto *</label>
                    <input type="text" id="product-name" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="product-price">Pre√ßo (R$) *</label>
                        <input type="number" id="product-price" step="0.01" min="0" required>
                    </div>

                    <div class="form-group">
                        <label for="product-category">Categoria *</label>
                        <select id="product-category" required>
                            <option value="">Selecione...</option>
                            <option value="Burguers">Burguers</option>
                            <option value="Hot-Dogs">Hot-Dogs</option>
                            <option value="Por√ß√µes">Por√ß√µes</option>
                            <option value="Bebidas">Bebidas</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="product-number">N√∫mero do Produto</label>
                        <input type="number" id="product-number" min="1" step="1" placeholder="Ex: 1, 2, 3...">
                        <small>N√∫mero usado para ordena√ß√£o e exibi√ß√£o (ex: "01 - V√ì MIMA"). Deixe vazio para produtos sem numera√ß√£o (ex: Bebidas).</small>
                    </div>
                </div>

                <!-- Se√ß√£o: Ingredientes (Padr√£o) -->
                <div class="form-group ingredients-section-group">
                    <label>Ingredientes (Padr√£o)</label>
                    <div class="ingredients-checkbox-list" id="product-default-ingredients-list">
                        <!-- Checkboxes de ingredientes padr√£o ser√£o carregados aqui -->
                        <p class="loading-text">Carregando ingredientes...</p>
                    </div>
                    <small>Marque os ingredientes que j√° v√™m inclu√≠dos no produto. A descri√ß√£o ser√° gerada automaticamente.</small>
                </div>

                <!-- Descri√ß√£o gerada automaticamente -->
                <div class="form-group">
                    <label for="product-description">Descri√ß√£o (Gerada automaticamente)</label>
                    <textarea id="product-description" rows="3" placeholder="A descri√ß√£o ser√° gerada automaticamente a partir dos ingredientes padr√£o selecionados..." readonly></textarea>
                    <small>A descri√ß√£o √© gerada automaticamente. Voc√™ pode edit√°-la manualmente se necess√°rio.</small>
                </div>

                <!-- Se√ß√£o: Ingredientes Dispon√≠veis -->
                <div class="form-group ingredients-section-group">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <label style="margin-bottom: 0;">Ingredientes Dispon√≠veis</label>
                        <button type="button" id="select-all-available-btn" class="btn-select-all">
                            Selecionar Todos
                        </button>
                    </div>
                    <div class="ingredients-checkbox-list" id="product-ingredients-list">
                        <!-- Checkboxes de ingredientes dispon√≠veis ser√£o carregados aqui -->
                        <p class="loading-text">Carregando ingredientes...</p>
                    </div>
                    <small>Marque os ingredientes que podem ser adicionados/removidos neste produto</small>
                </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="product-available" checked>
                            <span>Produto dispon√≠vel</span>
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-cancel" id="cancel-btn">Cancelar</button>
                <button type="submit" form="product-form" class="btn-save">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Notifica√ß√£o Toast -->
    <div id="toast" class="toast">    </div>

    <!-- Modal de Gerenciamento de Categorias -->
    <div id="categories-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="categories-modal-title">Gerenciar Categorias</h3>
                <button class="modal-close" id="categories-modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div id="categories-list-container">
                    <div class="loading" id="categories-loading" style="display: none;">
                        Carregando categorias...
                    </div>
                    <div id="categories-list">
                        <!-- Categorias ser√£o carregadas aqui -->
                    </div>
                </div>
                
                <!-- Formul√°rio para adicionar/editar categoria -->
                <div class="category-form-container" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #f0f0f0;">
                    <h4 id="category-form-title">Adicionar Categoria</h4>
                    <form id="category-form">
                        <input type="hidden" id="category-id">
                        <div class="form-group">
                            <label for="category-name">Nome da Categoria *</label>
                            <input type="text" id="category-name" required placeholder="Ex: Carnes, Vegetais, Molhos...">
                        </div>
                        <div class="form-actions" style="margin-top: 15px;">
                            <button type="button" class="btn-cancel" id="cancel-category-btn" style="display: none;">Cancelar</button>
                            <button type="submit" class="btn-save">Salvar Categoria</button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="close-categories-modal-btn">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module" src="../firebase-config.js"></script>
    <script type="module" src="../services/products-service.js"></script>
    <script type="module" src="../services/ingredients-service.js"></script>
    <script type="module" src="../services/categories-service.js"></script>
    <script type="module" src="../services/config-service.js"></script>
    <script type="module" src="../services/storage-service.js"></script>
    <!-- Modal de Feedback -->
    <div id="feedback-modal" class="modal-overlay">
        <div class="modal-content feedback-modal-content">
            <div class="modal-header">
                <h3 id="feedback-modal-title">Resultado da Cria√ß√£o</h3>
                <button class="modal-close" id="feedback-modal-close">&times;</button>
            </div>
            <div class="feedback-modal-body" id="feedback-modal-body">
                <!-- Conte√∫do ser√° inserido dinamicamente -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-primary" id="feedback-modal-ok">OK</button>
            </div>
        </div>
    </div>

    <!-- Modal de Confirma√ß√£o -->
    <div id="confirm-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="confirm-modal-title">Confirmar Exclus√£o</h3>
                <button class="modal-close" id="confirm-modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p id="confirm-modal-message"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="confirm-modal-cancel">Cancelar</button>
                <button type="button" class="btn-primary" id="confirm-modal-confirm">Confirmar</button>
            </div>
        </div>
    </div>

    <script type="module" src="admin.js"></script>
</body>
</html>

